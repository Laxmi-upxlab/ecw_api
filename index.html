<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>

    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            text-align: center;
        }

        /* Hide everything except timer */
        .hidden {
            display: none !important;
        }

        .timer-msg {
            margin-top: 100px;
            font-size: 22px;
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>

<body>

    <!-- Only this timer message will remain visible -->
    <p id="timer-display" class="timer-msg">Starting redirect in 3s...</p>

    <!-- Hidden container (kept only for functionality) -->
    <div id="hidden-container" class="hidden">
        <p id="authCode"></p>
        <p id="stateValue"></p>
    </div>

    <script>
        // Extract query parameters
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const state = urlParams.get('state');

        const timerDisplay = document.getElementById('timer-display');

        const LOCAL_SERVER_URL = "http://localhost:5002/callback";
        let countdown = 3;

        if (code && state) {
            // Countdown logic
            const timerInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    timerDisplay.textContent = `Starting redirect in ${countdown}s...`;
                } else {
                    timerDisplay.textContent = "Redirecting...";
                    clearInterval(timerInterval);
                }
            }, 1000);

            // Redirect after 3 seconds
            setTimeout(() => {
                const relayUrl = `${LOCAL_SERVER_URL}?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state)}`;
                window.location.replace(relayUrl);
            }, 3000);

        } else {
            timerDisplay.textContent = "Error: Missing authorization data.";
            timerDisplay.style.color = "red";
        }
    </script>

</body>
</html>
